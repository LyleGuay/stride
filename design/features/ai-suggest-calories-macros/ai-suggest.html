<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stride — AI Suggest (Mockup)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            stride: { 50: '#eef2ff', 100: '#e0e7ff', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca' }
          }
        }
      }
    }
  </script>
  <style>
    /* ── Spinner ── */
    @keyframes spin { to { transform: rotate(360deg); } }
    .spinner { animation: spin 0.7s linear infinite; }

    /* ── Suggestion row slide in ── */
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-4px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .slide-in { animation: slideDown 0.18s ease-out; }

    /* ── Pulse shimmer for skeleton ── */
    @keyframes pulse { 0%,100% { opacity: .4; } 50% { opacity: .9; } }
    .shimmer { animation: pulse 1.2s ease-in-out infinite; }

    /* ── Green flash ── */
    @keyframes flashGreen {
      0%   { background-color: #dcfce7; }
      100% { background-color: transparent; }
    }
    .flash { animation: flashGreen 0.7s ease-out forwards; }

    /* ── Table meal headers ── */
    .meal-header td { background: #f0f0f4; border-bottom: 1px solid #e5e7eb; }
    .meal-header td:first-child { border-left: 3px solid var(--c, #9ca3af); padding-left: 10px; }
    .meal-breakfast { --c: #f97316; }
    .meal-lunch     { --c: #eab308; }
    .meal-snack     { --c: #4ade80; }
    .item-row td:first-child { padding-left: 18px; }

    /* ── Toast ── */
    #toast {
      transition: opacity 0.25s ease, transform 0.25s ease;
      opacity: 0;
      transform: translateY(12px);
      pointer-events: none;
    }
    #toast.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    /* ── Bottom sheet ── */
    #bottomSheet { transition: transform 0.3s ease; }
    #sheetBackdrop { transition: opacity 0.3s ease; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">

<!-- ── Demo guide banner ── -->
<div class="sticky top-0 bg-indigo-700 text-white text-xs px-4 py-2 z-40 flex flex-wrap items-center gap-x-5 gap-y-1">
  <span class="font-semibold text-indigo-200 uppercase tracking-wide">Mockup: AI Suggest</span>
  <span>① <strong>Snack → + Add</strong>, type a food (e.g. <em>"5 chocolate chip cookies"</em>) — suggestion appears automatically</span>
  <span>② Click <strong>✦ Apply</strong> on the suggestion to fill the fields</span>
  <span>③ Try the <strong>Log Item sheet</strong> (+ FAB) for the modal version</span>
  <span>④ Try <em>"xyzzy"</em> for the unrecognized-food state</span>
</div>

<!-- Sidebar -->
<aside class="fixed top-0 left-0 h-full w-64 bg-white border-r border-gray-200 z-50 -translate-x-full lg:translate-x-0 transition-transform duration-200">
  <div class="p-5 border-b border-gray-100">
    <h1 class="text-xl font-bold text-stride-600">Stride</h1>
  </div>
  <nav class="p-3">
    <a href="#" class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-stride-50 text-stride-700 font-medium text-sm">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z"/></svg>
      Calorie Log
    </a>
  </nav>
</aside>

<main class="lg:ml-64 min-h-screen">
  <!-- Header -->
  <header class="sticky top-7 lg:top-0 bg-white/80 backdrop-blur border-b border-gray-200 z-30 px-4 py-3 flex items-center gap-3">
    <span class="font-semibold text-gray-800">Calorie Log</span>
    <div class="ml-auto w-8 h-8 rounded-full bg-stride-600 text-white flex items-center justify-center text-sm font-medium">L</div>
  </header>

  <div class="max-w-3xl mx-auto px-4 py-4 pb-28">

    <!-- Date header -->
    <div class="flex items-center justify-between mb-4">
      <button class="p-1.5 rounded hover:bg-gray-100">
        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"/></svg>
      </button>
      <div class="text-center">
        <span class="text-base font-semibold">Today</span>
        <span class="text-xs text-gray-500 ml-2">Sat, Feb 22, 2026</span>
      </div>
      <button class="p-1.5 rounded hover:bg-gray-100">
        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5"/></svg>
      </button>
    </div>

    <!-- Summary (static) -->
    <div class="bg-white border border-gray-200 rounded-lg p-4 mb-4 flex items-center gap-6">
      <div class="relative w-24 h-24 shrink-0">
        <svg class="w-full h-full -rotate-90" viewBox="0 0 120 120">
          <circle cx="60" cy="60" r="52" fill="none" stroke-width="10" stroke="#e5e7eb"/>
          <circle cx="60" cy="60" r="52" fill="none" stroke-width="10" stroke="#22c55e"
            stroke-dasharray="326.73" stroke-dashoffset="98" stroke-linecap="round"/>
        </svg>
        <div class="absolute inset-0 flex flex-col items-center justify-center">
          <span class="text-lg font-bold">820</span>
          <span class="text-[10px] text-gray-400">left</span>
        </div>
      </div>
      <div class="flex-1 min-w-0">
        <div class="grid grid-cols-3 gap-x-4 text-xs mb-2">
          <div><span class="text-gray-400">Eaten</span><br><span class="font-semibold text-sm">1,480</span></div>
          <div><span class="text-gray-400">Exercise</span><br><span class="font-semibold text-sm text-emerald-600">0</span></div>
          <div><span class="text-gray-400">Budget</span><br><span class="font-semibold text-sm">2,300</span></div>
        </div>
        <div class="grid grid-cols-3 gap-x-4 text-xs border-t border-gray-100 pt-2">
          <div><span class="text-blue-500 font-medium">Protein</span><br><span class="font-semibold">72</span><span class="text-gray-400"> / 150g</span></div>
          <div><span class="text-amber-500 font-medium">Carbs</span><br><span class="font-semibold">140</span><span class="text-gray-400"> / 250g</span></div>
          <div><span class="text-pink-500 font-medium">Fat</span><br><span class="font-semibold">62</span><span class="text-gray-400"> / 80g</span></div>
        </div>
      </div>
    </div>

    <!-- ═══════════════════════════════════════
         ITEM TABLE
         ═══════════════════════════════════════ -->
    <div class="bg-white border border-gray-200 rounded-lg overflow-x-auto">
      <table class="w-full text-xs border-collapse">
        <thead>
          <tr class="bg-gray-50 border-b border-gray-200 text-gray-500 uppercase tracking-wide">
            <th class="text-left py-2 px-3 font-medium">Item</th>
            <th class="text-right py-2 px-2 font-medium w-10">Qty</th>
            <th class="text-left py-2 px-2 font-medium w-16">Unit</th>
            <th class="text-right py-2 px-2 font-medium w-14">Cal</th>
            <th class="text-right py-2 px-2 font-medium w-10 hidden sm:table-cell">P</th>
            <th class="text-right py-2 px-2 font-medium w-10 hidden sm:table-cell">C</th>
            <th class="text-right py-2 px-2 font-medium w-10 hidden sm:table-cell">F</th>
            <th class="text-right py-2 px-3 font-medium sm:hidden">P/C/F</th>
          </tr>
        </thead>
        <tbody>

          <!-- Breakfast (static) -->
          <tr class="meal-header meal-breakfast border-t border-gray-200">
            <td colspan="4" class="py-1.5 px-3 font-semibold text-xs text-gray-700">Breakfast</td>
            <td colspan="3" class="py-1.5 px-2 text-right font-semibold text-gray-600 hidden sm:table-cell">670</td>
            <td class="py-1.5 px-3 text-right font-semibold text-gray-600 sm:hidden">670</td>
          </tr>
          <tr class="item-row border-t border-gray-50 hover:bg-gray-50">
            <td class="py-1.5 px-3 font-medium text-gray-800">Eggs (scrambled)</td>
            <td class="py-1.5 px-2 text-right text-gray-500">3</td>
            <td class="py-1.5 px-2 text-gray-500">Each</td>
            <td class="py-1.5 px-2 text-right font-medium">270</td>
            <td class="py-1.5 px-2 text-right text-blue-500 hidden sm:table-cell">18</td>
            <td class="py-1.5 px-2 text-right text-amber-500 hidden sm:table-cell">3</td>
            <td class="py-1.5 px-2 text-right text-pink-500 hidden sm:table-cell">21</td>
            <td class="py-1.5 px-3 text-right text-gray-400 sm:hidden">18/3/21</td>
          </tr>
          <tr class="item-row border-t border-gray-50 hover:bg-gray-50">
            <td class="py-1.5 px-3 font-medium text-gray-800">Banana Smoothie</td>
            <td class="py-1.5 px-2 text-right text-gray-500">1</td>
            <td class="py-1.5 px-2 text-gray-500">Each</td>
            <td class="py-1.5 px-2 text-right font-medium">400</td>
            <td class="py-1.5 px-2 text-right text-blue-500 hidden sm:table-cell">25</td>
            <td class="py-1.5 px-2 text-right text-amber-500 hidden sm:table-cell">55</td>
            <td class="py-1.5 px-2 text-right text-pink-500 hidden sm:table-cell">8</td>
            <td class="py-1.5 px-3 text-right text-gray-400 sm:hidden">25/55/8</td>
          </tr>
          <tr class="border-t border-gray-50">
            <td colspan="8" class="py-0">
              <button class="w-full text-left py-1.5 pl-[18px] text-[11px] text-gray-400 hover:text-stride-600 transition-colors">+ Add</button>
            </td>
          </tr>

          <!-- Lunch (static, empty) -->
          <tr class="meal-header meal-lunch border-t border-gray-200">
            <td colspan="4" class="py-1.5 px-3 font-semibold text-xs text-gray-700">Lunch</td>
            <td colspan="3" class="py-1.5 px-2 text-right font-semibold text-gray-400 hidden sm:table-cell">0</td>
            <td class="py-1.5 px-3 text-right font-semibold text-gray-400 sm:hidden">0</td>
          </tr>
          <tr class="border-t border-gray-50">
            <td colspan="8" class="py-0">
              <button class="w-full text-left py-1.5 pl-[18px] text-[11px] text-gray-400 hover:text-stride-600 transition-colors">+ Add</button>
            </td>
          </tr>

          <!-- ═══════════════════════════════════════
               SNACK — interactive demo section
               ═══════════════════════════════════════ -->
          <tr class="meal-header meal-snack border-t border-gray-200">
            <td colspan="4" class="py-1.5 px-3 font-semibold text-xs text-gray-700">Snack</td>
            <td colspan="3" class="py-1.5 px-2 text-right font-semibold text-gray-400 hidden sm:table-cell">810</td>
            <td class="py-1.5 px-3 text-right font-semibold text-gray-400 sm:hidden">810</td>
          </tr>
          <tr class="item-row border-t border-gray-50 hover:bg-gray-50">
            <td class="py-1.5 px-3 font-medium text-gray-800">Greek Yogurt</td>
            <td class="py-1.5 px-2 text-right text-gray-500">1</td>
            <td class="py-1.5 px-2 text-gray-500">Each</td>
            <td class="py-1.5 px-2 text-right font-medium">120</td>
            <td class="py-1.5 px-2 text-right text-blue-500 hidden sm:table-cell">17</td>
            <td class="py-1.5 px-2 text-right text-amber-500 hidden sm:table-cell">9</td>
            <td class="py-1.5 px-2 text-right text-pink-500 hidden sm:table-cell">0</td>
            <td class="py-1.5 px-3 text-right text-gray-400 sm:hidden">17/9/0</td>
          </tr>

          <!-- + Add trigger -->
          <tr id="snack-trigger" class="border-t border-gray-50">
            <td colspan="8" class="py-0">
              <button onclick="openInlineAdd()" class="w-full text-left py-1.5 pl-[18px] text-[11px] text-gray-400 hover:text-stride-600 transition-colors">+ Add</button>
            </td>
          </tr>

          <!-- ── Inline add row (expanded) ── -->
          <tr id="inline-row" class="hidden border-t border-stride-100 bg-stride-50/30">
            <!-- Name field -->
            <td class="py-1 pl-[14px] pr-1">
              <div class="flex items-center gap-1">
                <input
                  id="inline-name"
                  type="text"
                  placeholder="Item name"
                  oninput="onInlineType(this)"
                  onkeydown="inlineKey(event)"
                  class="flex-1 min-w-0 border border-stride-300 rounded px-1.5 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-stride-500 bg-white"
                />
                <button id="inline-add-btn" onclick="submitInline()" disabled
                  class="shrink-0 bg-stride-600 text-white text-[11px] px-2 py-1 rounded hover:bg-stride-700 disabled:opacity-40 disabled:cursor-not-allowed transition-colors">
                  Add
                </button>
                <button onclick="closeInlineAdd()" tabindex="-1" class="shrink-0 text-gray-400 hover:text-gray-600 text-xs px-0.5" aria-label="Cancel">✕</button>
              </div>
            </td>
            <!-- Qty -->
            <td class="py-1 px-1 w-14">
              <input id="inline-qty" type="number" value="1" min="0" step="0.25"
                class="w-full border border-gray-200 rounded px-1 py-1 text-xs text-right focus:outline-none focus:border-stride-400 bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none" />
            </td>
            <!-- Unit -->
            <td class="py-1 px-1 w-20">
              <select id="inline-uom" class="w-full border border-gray-200 rounded px-1 py-1 text-xs focus:outline-none focus:border-stride-400 bg-white">
                <option value="each">Each</option><option value="g">g</option>
                <option value="miles">Miles</option><option value="km">km</option><option value="minutes">Minutes</option>
              </select>
            </td>
            <!-- Cal -->
            <td class="py-1 px-1 w-16">
              <input id="inline-cal" type="number" placeholder="Cal"
                oninput="updateInlineAddBtn()"
                class="w-full border border-gray-200 rounded px-1 py-1 text-xs text-right focus:outline-none focus:border-stride-400 bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none" />
            </td>
            <!-- P / C / F (desktop) -->
            <td class="py-1 px-1 w-12 hidden sm:table-cell">
              <input id="inline-protein" type="number" placeholder="P"
                class="w-full border border-gray-200 rounded px-1 py-1 text-xs text-right focus:outline-none focus:border-stride-400 bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none" />
            </td>
            <td class="py-1 px-1 w-12 hidden sm:table-cell">
              <input id="inline-carbs" type="number" placeholder="C"
                class="w-full border border-gray-200 rounded px-1 py-1 text-xs text-right focus:outline-none focus:border-stride-400 bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none" />
            </td>
            <td class="py-1 px-1 w-12 hidden sm:table-cell">
              <input id="inline-fat" type="number" placeholder="F"
                class="w-full border border-gray-200 rounded px-1 py-1 text-xs text-right focus:outline-none focus:border-stride-400 bg-white [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none" />
            </td>
            <td class="sm:hidden"></td>
          </tr>

          <!-- ── Suggestion row (below inline add row) ── -->
          <!--
            States:
              hidden   → not shown
              loading  → skeleton/spinner
              ready    → shows parsed suggestion + Apply button
              warn     → couldn't recognize food
          -->
          <tr id="suggest-row" class="hidden">
            <td colspan="8" class="px-0 py-0">
              <!-- Loading state -->
              <div id="suggest-loading" class="hidden flex items-center gap-2 px-4 py-2 bg-indigo-50 border-t border-indigo-100">
                <svg class="w-3.5 h-3.5 text-stride-400 spinner shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <path stroke-linecap="round" d="M12 2a10 10 0 0 1 10 10" opacity=".3"/>
                  <path stroke-linecap="round" d="M12 2a10 10 0 0 1 10 10"/>
                </svg>
                <span class="text-[11px] text-stride-400 shimmer">Looking up nutrition...</span>
              </div>
              <!-- Ready state -->
              <div id="suggest-ready" class="hidden slide-in flex items-center gap-2 px-3 py-1.5 bg-indigo-50 border-t border-indigo-100">
                <!-- Sparkle icon -->
                <svg class="w-3 h-3 text-stride-400 shrink-0" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M8 1l1.5 4.5L14 7l-4.5 1.5L8 13l-1.5-4.5L2 7l4.5-1.5L8 1z"/>
                </svg>
                <!-- Suggestion text -->
                <span id="suggest-text" class="flex-1 text-[11px] text-stride-700 min-w-0 truncate"></span>
                <!-- Apply button -->
                <button onclick="applyInlineSuggestion()" class="shrink-0 flex items-center gap-1 px-2 py-1 rounded bg-stride-600 hover:bg-stride-700 text-white text-[11px] font-medium transition-colors">
                  <svg class="w-2.5 h-2.5" viewBox="0 0 16 16" fill="currentColor"><path d="M8 1l1.5 4.5L14 7l-4.5 1.5L8 13l-1.5-4.5L2 7l4.5-1.5L8 1z"/></svg>
                  Apply
                </button>
                <!-- Dismiss -->
                <button onclick="dismissSuggest()" class="shrink-0 text-stride-300 hover:text-stride-500 text-xs px-0.5" aria-label="Dismiss">✕</button>
              </div>
              <!-- Warning state (unrecognized food) -->
              <div id="suggest-warn" class="hidden slide-in flex items-center gap-2 px-3 py-1.5 bg-amber-50 border-t border-amber-100">
                <svg class="w-3.5 h-3.5 text-amber-400 shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>
                </svg>
                <span class="flex-1 text-[11px] text-amber-700">Couldn't determine nutrition for this item — enter manually.</span>
                <button onclick="dismissSuggest()" class="shrink-0 text-amber-300 hover:text-amber-500 text-xs px-0.5" aria-label="Dismiss">✕</button>
              </div>
            </td>
          </tr>

          <!-- Net totals -->
          <tr class="border-t-2 border-gray-300 bg-gray-50 font-semibold text-xs">
            <td class="py-2 px-3 text-gray-700">Net Total</td>
            <td colspan="2" class="py-2 px-2"></td>
            <td class="py-2 px-2 text-right">1,480</td>
            <td class="py-2 px-2 text-right text-blue-600 hidden sm:table-cell">72</td>
            <td class="py-2 px-2 text-right text-amber-600 hidden sm:table-cell">140</td>
            <td class="py-2 px-2 text-right text-pink-600 hidden sm:table-cell">62</td>
            <td class="py-2 px-3 text-right text-gray-500 sm:hidden">72/140/62</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Callout -->
    <div class="mt-4 bg-amber-50 border border-amber-200 rounded-lg px-4 py-3 text-xs text-amber-800 space-y-1">
      <p class="font-semibold">Try the demo ↑</p>
      <p>Click <strong>+ Add</strong> in the Snack section. Type a food like <em>"5 chocolate chip cookies"</em>, <em>"oatmeal"</em>, or <em>"2 slices pizza"</em>. After a short pause, a suggestion appears below. Click <strong>✦ Apply</strong> to fill the fields. Try <em>"xyzzy"</em> for the unrecognized-food warning. Open the Log Item sheet (FAB) to see the modal variant.</p>
    </div>

  </div><!-- /max-w -->

  <!-- FAB -->
  <button onclick="openSheet()" class="fixed bottom-6 right-6 w-14 h-14 bg-stride-600 hover:bg-stride-700 text-white rounded-full shadow-lg flex items-center justify-center z-30 transition-colors">
    <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
  </button>
</main>

<!-- Toast -->
<div id="toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 z-50 flex items-center gap-2 bg-red-600 text-white text-xs font-medium px-4 py-2 rounded-full shadow-lg">
  <svg class="w-4 h-4 shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"/>
  </svg>
  Suggestion failed — please try again.
</div>

<!-- ═══════════════════════════════════
     ADD ITEM BOTTOM SHEET
     ═══════════════════════════════════ -->
<div id="sheetBackdrop" class="fixed inset-0 bg-black/40 z-50 opacity-0 pointer-events-none" onclick="closeSheet()"></div>
<div id="bottomSheet" class="fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl z-50 translate-y-full shadow-2xl" style="max-height:88vh;">
  <div class="flex justify-center pt-3 pb-1"><div class="w-10 h-1 bg-gray-300 rounded-full"></div></div>
  <div class="px-5 pb-6 overflow-y-auto" style="max-height:calc(88vh - 2rem);">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold">Log Item</h2>
      <button onclick="closeSheet()" class="w-8 h-8 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100 flex items-center justify-center">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </div>

    <!-- Item name -->
    <div class="mb-3">
      <label class="block text-sm font-medium text-gray-700 mb-1">Item name</label>
      <input
        id="sheet-name"
        type="text"
        placeholder="e.g. 5 chocolate chip cookies"
        oninput="onSheetType(this)"
        class="w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-stride-500 focus:border-transparent"
      />

      <!-- ── Suggestion card (appears below the name input) ── -->
      <div id="sheet-suggest-card" class="hidden mt-2 rounded-lg border overflow-hidden text-sm">
        <!-- Loading -->
        <div id="sheet-sug-loading" class="hidden flex items-center gap-2.5 px-3 py-2.5 bg-indigo-50 border-indigo-100">
          <svg class="w-4 h-4 text-stride-400 spinner shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" d="M12 2a10 10 0 0 1 10 10" opacity=".3"/>
            <path stroke-linecap="round" d="M12 2a10 10 0 0 1 10 10"/>
          </svg>
          <span class="text-xs text-stride-400 shimmer">Looking up nutrition...</span>
        </div>
        <!-- Ready -->
        <div id="sheet-sug-ready" class="hidden slide-in bg-indigo-50 border-indigo-100 px-3 py-2.5">
          <div class="flex items-start gap-2">
            <svg class="w-4 h-4 text-stride-400 shrink-0 mt-0.5" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 1l1.5 4.5L14 7l-4.5 1.5L8 13l-1.5-4.5L2 7l4.5-1.5L8 1z"/>
            </svg>
            <div class="flex-1 min-w-0">
              <p id="sheet-sug-name" class="text-xs font-semibold text-stride-800 truncate"></p>
              <p id="sheet-sug-detail" class="text-xs text-stride-600 mt-0.5"></p>
            </div>
            <button onclick="applySheetSuggestion()"
              class="shrink-0 flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-stride-600 hover:bg-stride-700 text-white text-xs font-medium transition-colors">
              <svg class="w-3 h-3" viewBox="0 0 16 16" fill="currentColor"><path d="M8 1l1.5 4.5L14 7l-4.5 1.5L8 13l-1.5-4.5L2 7l4.5-1.5L8 1z"/></svg>
              Apply
            </button>
          </div>
        </div>
        <!-- Warning -->
        <div id="sheet-sug-warn" class="hidden slide-in bg-amber-50 border-amber-100 px-3 py-2.5 flex items-start gap-2">
          <svg class="w-4 h-4 text-amber-400 shrink-0 mt-0.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/>
          </svg>
          <div>
            <p class="text-xs font-medium text-amber-800">Couldn't determine nutrition for this item.</p>
            <p class="text-xs text-amber-600 mt-0.5">Try being more specific — e.g. "medium apple" or "1 cup oatmeal".</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Type selector -->
    <div class="mb-3">
      <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
      <div class="grid grid-cols-5 gap-1">
        <button onclick="selectType(this)" class="type-btn px-2 py-2 text-xs font-medium rounded-lg border border-gray-200 bg-gray-50 text-gray-600 hover:bg-gray-100 capitalize">breakfast</button>
        <button onclick="selectType(this)" class="type-btn px-2 py-2 text-xs font-medium rounded-lg border border-gray-200 bg-gray-50 text-gray-600 hover:bg-gray-100 capitalize">lunch</button>
        <button onclick="selectType(this)" class="type-btn px-2 py-2 text-xs font-medium rounded-lg border border-gray-200 bg-gray-50 text-gray-600 hover:bg-gray-100 capitalize">dinner</button>
        <button onclick="selectType(this)" class="type-btn px-2 py-2 text-xs font-medium rounded-lg border border-stride-600 bg-stride-50 text-stride-700 capitalize">snack</button>
        <button onclick="selectType(this)" class="type-btn px-2 py-2 text-xs font-medium rounded-lg border border-gray-200 bg-gray-50 text-gray-600 hover:bg-gray-100 capitalize">exercise</button>
      </div>
    </div>

    <!-- Qty + Unit -->
    <div class="grid grid-cols-2 gap-3 mb-3">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
        <input id="sheet-qty" type="number" value="1" min="0" step="0.25"
          class="w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-stride-500 focus:border-transparent">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Unit</label>
        <select id="sheet-uom" class="w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm bg-white focus:outline-none focus:ring-2 focus:ring-stride-500 focus:border-transparent">
          <option>Each</option><option>g</option><option>Miles</option><option>km</option><option>Minutes</option>
        </select>
      </div>
    </div>
    <!-- Calories -->
    <div class="mb-3">
      <label class="block text-sm font-medium text-gray-700 mb-1">Calories</label>
      <input id="sheet-cal" type="number" placeholder="0"
        class="w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-stride-500 focus:border-transparent">
    </div>
    <!-- Macros -->
    <div class="grid grid-cols-3 gap-3 mb-5">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Protein (g)</label>
        <input id="sheet-protein" type="number" placeholder="—"
          class="w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-stride-500 focus:border-transparent">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Carbs (g)</label>
        <input id="sheet-carbs" type="number" placeholder="—"
          class="w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-stride-500 focus:border-transparent">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Fat (g)</label>
        <input id="sheet-fat" type="number" placeholder="—"
          class="w-full border border-gray-300 rounded-lg px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-stride-500 focus:border-transparent">
      </div>
    </div>
    <button onclick="closeSheet()" class="w-full bg-stride-600 hover:bg-stride-700 text-white font-medium py-3 rounded-xl transition-colors">Save Item</button>
  </div>
</div>

<!-- ═══════════════════════════════════════
     SCRIPTS
     ═══════════════════════════════════════ -->
<script>
  /* ─── Fake AI data ────────────────────────────────────────────────────
     Keyed by keyword; 'unrecognized' triggers the warning state.
     The string 'api-error' triggers the toast error state.             */
  const FAKE_DB = {
    cookie:    { item_name: 'Chocolate Chip Cookies', qty: 5,  uom: 'each',    calories: 185, protein_g: 2,  carbs_g: 25, fat_g: 9 },
    oatmeal:   { item_name: 'Oatmeal',                qty: 1,  uom: 'each',    calories: 158, protein_g: 6,  carbs_g: 27, fat_g: 3 },
    banana:    { item_name: 'Banana',                 qty: 1,  uom: 'each',    calories: 105, protein_g: 1,  carbs_g: 27, fat_g: 0 },
    apple:     { item_name: 'Apple',                  qty: 1,  uom: 'each',    calories: 95,  protein_g: 0,  carbs_g: 25, fat_g: 0 },
    almonds:   { item_name: 'Almonds',                qty: 28, uom: 'g',       calories: 164, protein_g: 6,  carbs_g: 6,  fat_g: 14 },
    pizza:     { item_name: 'Pizza Slice',            qty: 2,  uom: 'each',    calories: 570, protein_g: 24, carbs_g: 70, fat_g: 22 },
    burger:    { item_name: 'Hamburger',              qty: 1,  uom: 'each',    calories: 540, protein_g: 30, carbs_g: 42, fat_g: 24 },
    coffee:    { item_name: 'Coffee w/ Cream & Sugar',qty: 1,  uom: 'each',    calories: 80,  protein_g: 1,  carbs_g: 13, fat_g: 3 },
    salad:     { item_name: 'Mixed Green Salad',      qty: 1,  uom: 'each',    calories: 130, protein_g: 4,  carbs_g: 12, fat_g: 7 },
    chicken:   { item_name: 'Grilled Chicken Breast', qty: 150,uom: 'g',       calories: 248, protein_g: 46, carbs_g: 0,  fat_g: 5 },
    rice:      { item_name: 'White Rice (cooked)',    qty: 1,  uom: 'each',    calories: 206, protein_g: 4,  carbs_g: 45, fat_g: 0 },
    // Special states
    xyzzy:     'unrecognized',
    error:     'api-error',
  }

  function getFakeResult(text) {
    const t = text.toLowerCase()
    // Check special triggers first
    if (t.includes('xyzzy')) return 'unrecognized'
    if (t.includes('error') || t.includes('fail')) return 'api-error'
    // Look for a known food keyword
    for (const [key, data] of Object.entries(FAKE_DB)) {
      if (key === 'xyzzy' || key === 'error') continue
      if (t.includes(key)) {
        const result = { ...data }
        // Try to parse a leading number for qty override
        const m = t.match(/^(\d+\.?\d*)\s+/)
        if (m) result.qty = parseFloat(m[1])
        return result
      }
    }
    // Fallback — generic result
    const m = t.match(/^(\d+\.?\d*)\s+/)
    return { item_name: toTitleCase(t.replace(/^\d+\.?\d*\s+/, '').trim()), qty: m ? parseFloat(m[1]) : 1, uom: 'each', calories: 220, protein_g: 5, carbs_g: 30, fat_g: 8 }
  }

  function toTitleCase(s) {
    return s.replace(/\w\S*/g, w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
  }

  function fmtDetail(d) {
    return `${d.qty} × ${ucfirst(d.uom)} · ${d.calories} cal · ${d.protein_g}g P · ${d.carbs_g}g C · ${d.fat_g}g F`
  }

  function ucfirst(s) { return s ? s.charAt(0).toUpperCase() + s.slice(1) : '' }

  /* ─── Debounce helper ────────────────────────────────── */
  function debounce(fn, ms) {
    let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms) }
  }

  /* ─── Flash helper ───────────────────────────────────── */
  function flash(ids) {
    ids.forEach(id => {
      const el = document.getElementById(id)
      if (!el) return
      el.classList.remove('flash'); void el.offsetWidth; el.classList.add('flash')
      setTimeout(() => el.classList.remove('flash'), 800)
    })
  }

  /* ─── Toast ──────────────────────────────────────────── */
  function showToast() {
    const t = document.getElementById('toast')
    t.classList.add('show')
    setTimeout(() => t.classList.remove('show'), 3500)
  }

  /* ═══════════════════════════════════════
     INLINE ADD — open / close / submit
     ═══════════════════════════════════════ */
  function openInlineAdd() {
    document.getElementById('snack-trigger').classList.add('hidden')
    document.getElementById('inline-row').classList.remove('hidden')
    document.getElementById('inline-name').focus()
  }

  function closeInlineAdd() {
    document.getElementById('inline-row').classList.add('hidden')
    document.getElementById('snack-trigger').classList.remove('hidden')
    hideSuggestRow()
    resetInlineFields()
  }

  function resetInlineFields() {
    document.getElementById('inline-name').value = ''
    document.getElementById('inline-qty').value = '1'
    document.getElementById('inline-uom').value = 'each'
    document.getElementById('inline-cal').value = ''
    document.getElementById('inline-protein').value = ''
    document.getElementById('inline-carbs').value = ''
    document.getElementById('inline-fat').value = ''
    document.getElementById('inline-add-btn').disabled = true
  }

  function updateInlineAddBtn() {
    const name = document.getElementById('inline-name').value.trim()
    const cal  = document.getElementById('inline-cal').value
    document.getElementById('inline-add-btn').disabled = !(name && cal)
  }

  function submitInline() {
    const btn = document.getElementById('inline-add-btn')
    btn.textContent = '✓'
    btn.classList.replace('bg-stride-600', 'bg-green-500')
    hideSuggestRow()
    setTimeout(() => closeInlineAdd(), 600)
  }

  function inlineKey(e) {
    if (e.key === 'Enter') submitInline()
    if (e.key === 'Escape') closeInlineAdd()
  }

  /* ─── Inline suggest flow ────────────────────────────── */
  let inlineSuggestData = null // stores the last received suggestion

  const triggerInlineSuggest = debounce((text) => {
    if (text.length < 2) { hideSuggestRow(); return }
    showSuggestRow('loading')

    const delay = 700 + Math.random() * 500
    setTimeout(() => {
      const result = getFakeResult(text)
      if (result === 'api-error') {
        hideSuggestRow()
        showToast()
      } else if (result === 'unrecognized') {
        showSuggestRow('warn')
        inlineSuggestData = null
      } else {
        inlineSuggestData = result
        document.getElementById('suggest-text').textContent = `${result.item_name} · ${fmtDetail(result)}`
        showSuggestRow('ready')
      }
    }, delay)
  }, 600)

  function onInlineType(input) {
    updateInlineAddBtn()
    const text = input.value.trim()
    if (!text) { hideSuggestRow(); inlineSuggestData = null; return }
    triggerInlineSuggest(text)
  }

  function showSuggestRow(state) {
    const row = document.getElementById('suggest-row')
    row.classList.remove('hidden')
    document.getElementById('suggest-loading').classList.toggle('hidden', state !== 'loading')
    document.getElementById('suggest-loading').classList.toggle('flex',   state === 'loading')
    document.getElementById('suggest-ready').classList.toggle('hidden',   state !== 'ready')
    document.getElementById('suggest-ready').classList.toggle('flex',     state === 'ready')
    document.getElementById('suggest-warn').classList.toggle('hidden',    state !== 'warn')
    document.getElementById('suggest-warn').classList.toggle('flex',      state === 'warn')
  }

  function hideSuggestRow() {
    document.getElementById('suggest-row').classList.add('hidden')
    inlineSuggestData = null
  }

  function dismissSuggest() { hideSuggestRow() }

  function applyInlineSuggestion() {
    if (!inlineSuggestData) return
    const d = inlineSuggestData
    document.getElementById('inline-name').value    = d.item_name
    document.getElementById('inline-qty').value     = d.qty
    document.getElementById('inline-uom').value     = d.uom || 'each'
    document.getElementById('inline-cal').value     = d.calories
    document.getElementById('inline-protein').value = d.protein_g ?? ''
    document.getElementById('inline-carbs').value   = d.carbs_g ?? ''
    document.getElementById('inline-fat').value     = d.fat_g ?? ''
    document.getElementById('inline-add-btn').disabled = false
    hideSuggestRow()
    flash(['inline-name', 'inline-qty', 'inline-cal', 'inline-protein', 'inline-carbs', 'inline-fat'])
  }

  /* ═══════════════════════════════════════
     SHEET — open / close
     ═══════════════════════════════════════ */
  function openSheet() {
    document.getElementById('bottomSheet').classList.remove('translate-y-full')
    document.getElementById('sheetBackdrop').classList.remove('opacity-0', 'pointer-events-none')
    setTimeout(() => document.getElementById('sheet-name').focus(), 300)
  }

  function closeSheet() {
    document.getElementById('bottomSheet').classList.add('translate-y-full')
    document.getElementById('sheetBackdrop').classList.add('opacity-0', 'pointer-events-none')
    // Reset sheet
    document.getElementById('sheet-name').value = ''
    document.getElementById('sheet-suggest-card').classList.add('hidden')
    hideSheetSugStates()
    sheetSuggestData = null
    ;['sheet-qty','sheet-cal','sheet-protein','sheet-carbs','sheet-fat'].forEach(id => {
      const el = document.getElementById(id)
      if (el) el.value = id === 'sheet-qty' ? '1' : ''
    })
    document.getElementById('sheet-uom').selectedIndex = 0
  }

  function selectType(btn) {
    document.querySelectorAll('.type-btn').forEach(b => {
      b.classList.remove('border-stride-600','bg-stride-50','text-stride-700')
      b.classList.add('border-gray-200','bg-gray-50','text-gray-600')
    })
    btn.classList.remove('border-gray-200','bg-gray-50','text-gray-600')
    btn.classList.add('border-stride-600','bg-stride-50','text-stride-700')
  }

  /* ─── Sheet suggest flow ─────────────────────────────── */
  let sheetSuggestData = null

  const triggerSheetSuggest = debounce((text) => {
    if (text.length < 2) { hideSheetSugCard(); return }
    showSheetSugState('loading')

    const delay = 700 + Math.random() * 500
    setTimeout(() => {
      const result = getFakeResult(text)
      if (result === 'api-error') {
        hideSheetSugCard()
        showToast()
      } else if (result === 'unrecognized') {
        showSheetSugState('warn')
        sheetSuggestData = null
      } else {
        sheetSuggestData = result
        document.getElementById('sheet-sug-name').textContent   = result.item_name
        document.getElementById('sheet-sug-detail').textContent = fmtDetail(result)
        showSheetSugState('ready')
      }
    }, delay)
  }, 600)

  function onSheetType(input) {
    const text = input.value.trim()
    if (!text) { hideSheetSugCard(); sheetSuggestData = null; return }
    triggerSheetSuggest(text)
  }

  function showSheetSugState(state) {
    document.getElementById('sheet-suggest-card').classList.remove('hidden')
    hideSheetSugStates()
    const el = document.getElementById(`sheet-sug-${state}`)
    if (el) { el.classList.remove('hidden'); el.classList.add(state === 'warn' ? 'flex' : 'flex') }
  }

  function hideSheetSugStates() {
    ['sheet-sug-loading','sheet-sug-ready','sheet-sug-warn'].forEach(id => {
      const el = document.getElementById(id)
      if (el) { el.classList.add('hidden'); el.classList.remove('flex') }
    })
  }

  function hideSheetSugCard() {
    document.getElementById('sheet-suggest-card').classList.add('hidden')
    hideSheetSugStates()
    sheetSuggestData = null
  }

  function applySheetSuggestion() {
    if (!sheetSuggestData) return
    const d = sheetSuggestData
    document.getElementById('sheet-name').value    = d.item_name
    document.getElementById('sheet-qty').value     = d.qty
    // Match uom option by value
    const uomSel = document.getElementById('sheet-uom')
    for (let i = 0; i < uomSel.options.length; i++) {
      if (uomSel.options[i].value.toLowerCase() === (d.uom || 'each').toLowerCase() ||
          uomSel.options[i].text.toLowerCase()  === (d.uom || 'each').toLowerCase()) {
        uomSel.selectedIndex = i; break
      }
    }
    document.getElementById('sheet-cal').value     = d.calories
    document.getElementById('sheet-protein').value = d.protein_g ?? ''
    document.getElementById('sheet-carbs').value   = d.carbs_g ?? ''
    document.getElementById('sheet-fat').value     = d.fat_g ?? ''
    hideSheetSugCard()
    flash(['sheet-name','sheet-qty','sheet-cal','sheet-protein','sheet-carbs','sheet-fat'])
  }

  /* ─── Escape ──────────────────────────────────────────── */
  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeSheet() })
</script>
</body>
</html>
